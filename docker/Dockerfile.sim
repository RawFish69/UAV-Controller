FROM python:3.12-slim

SHELL ["/bin/bash", "-lc"]
ARG DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    python3-venv \
    build-essential \
    git \
    libgl1 \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /workspace

COPY sim_py /workspace/sim_py
COPY scripts /workspace/scripts
COPY Utils /workspace/Utils
COPY gps /workspace/gps

RUN /workspace/scripts/setup_sim_py_venv.sh && \
    /workspace/sim_py/.venv/bin/python -m pip install -r /workspace/Utils/requirements.txt && \
    /workspace/sim_py/.venv/bin/python -m pip install -r /workspace/gps/requirements-dashboard.txt

ENV PATH="/workspace/sim_py/.venv/bin:${PATH}"
CMD ["bash"]
